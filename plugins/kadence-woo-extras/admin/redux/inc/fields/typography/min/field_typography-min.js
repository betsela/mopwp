!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.typography=redux.field_objects.typography||{};var t=[],a=!1,r={width:"resolve",triggerChange:!0,allowClear:!0};redux.field_objects.typography.init=function(o,p){o||(o=e(document).find(".redux-group-tab:visible").find(".redux-container-typography:visible")),e(o).each((function(){var o=e(this),p=o,s;(o.hasClass("redux-field-container")||(p=o.parents(".redux-field-container:first")),p.is(":hidden"))||p.hasClass("redux-field-init")&&(p.removeClass("redux-field-init"),o.each((function(){e(this).find(".redux-typography-container").each((function(){var t=e(this).find(".redux-typography-family");void 0===t.data("value")?t=e(this):""!==t.data("value")&&e(t).val(t.data("value"));var a=e(this).find(".select2_params");if(a.size()>0){var o=a.val();o=JSON.parse(o),r=e.extend({},r,o)}s=Boolean(e(this).find(".redux-font-clear").val()),redux.field_objects.typography.select(t,!0),window.onbeforeunload=null})),e(this).find(".redux-typography").on("change",(function(){redux.field_objects.typography.select(e(this))})),e(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup((function(){redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))})),e(this).find(".redux-typography-color").wpColorPicker({change:function(t,a){e(this).val(a.color.toString()),redux.field_objects.typography.select(e(this))}}),e(this).find(".redux-typography-size").numeric({allowMinus:!1}),e(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:!0});var p=[{id:"none",text:"none"}],y;e(this).find(".redux-typography-family").select2({matcher:function(e,t){return 0===t.toUpperCase().indexOf(e.toUpperCase())},query:function(e){return window.Select2.query.local(p)(e)},initSelection:function(e,t){var a;t({id:e.val(),text:e.val()})},allowClear:s}).on("select2-opening",(function(t){var a=e(this).parents(".redux-container-typography:first").attr("data-id"),r=e("#"+a+" .redux-typography-font-family").data("user-fonts");r=r?1:0;var o=e("#"+a+" .redux-typography-google").val();o=o?1:0;var s=[];if(void 0!==redux.customfonts&&s.push(redux.customfonts),void 0!==redux.stdfonts&&0===r&&s.push(redux.stdfonts),1==r){var y=[];for(var i in redux.typography[a]){var l=redux.typography[a].std_font;for(var n in l)l.hasOwnProperty(n)&&y.push({id:n,text:n,"data-google":"false"})}var d={text:"Standard Fonts",children:y};s.push(d)}(1==o||!0===o&&void 0!==redux.googlefonts)&&s.push(redux.googlefonts),p=s;var h=e("#"+a+" #"+a+"-family").attr("placeholder");h||(h=null),e("#"+a+" .redux-typography-family").select2("val",h)})).on("select2-selecting",(function(r,o){var p=r.object.text,s=e(this).parents(".redux-container-typography:first").attr("data-id");e("#"+s+" #"+s+"-family").data("value",p),e("#"+s+" #"+s+"-family").attr("placeholder",p),t=r,a=!0,redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))})).on("select2-clearing",(function(t,a){var r=e(this).parents(".redux-container-typography:first").attr("data-id");e("#"+r+" #"+r+"-family").attr("data-value",""),e("#"+r+" #"+r+"-family").attr("placeholder","Font Family"),e("#"+r+" #"+r+"-google-font").val("false"),redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))})),o.find(".redux-typography-family").hasClass("redux-typography-family")||o.find(".redux-typography-style").select2(r),o.find(".redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(r)})))}))},redux.field_objects.typography.size=function(e){var t=0,a;for(a in e)e.hasOwnProperty(a)&&t++;return t},redux.field_objects.typography.makeBool=function(e){return"false"!=e&&"0"!=e&&!1!==e&&0!==e&&("true"==e||"1"==e||!0===e||1==e||void 0)},redux.field_objects.typography.contrastColour=function(e){var t="#444444",a,r,o,p;""!==e&&(e=e.replace("#",""),t=(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=128?"#444444":"#ffffff");return t},redux.field_objects.typography.select=function(o,p){var s;void 0===(s=e(o).parents(".redux-container-typography:first").attr("data-id"))&&(s=e(o).attr("data-id"));var y=e(o).parents(".redux-container-typography:first"),i=[],l=e("#"+s+" #"+s+"-family").val();l||(l=null);var n=e("#"+s+" select.redux-typography-family-backup").val(),d=e("#"+s+" .redux-typography-size").val(),h=e("#"+s+" .redux-typography-height").val(),u=e("#"+s+" .redux-typography-word").val(),g=e("#"+s+" .redux-typography-letter").val(),c=e("#"+s+" select.redux-typography-align").val(),f=e("#"+s+" select.redux-typography-transform").val(),x=e("#"+s+" select.redux-typography-font-variant").val(),v=e("#"+s+" select.redux-typography-decoration").val(),b=e("#"+s+" select.redux-typography-style").val(),m=e("#"+s+" select.redux-typography-subsets").val(),w=e("#"+s+" .redux-typography-color").val(),_=e("#"+s).data("units"),j;!0===a?(j=redux.field_objects.typography.makeBool(t.object["data-google"]),e("#"+s+" .redux-typography-google-font").val(j)):j=redux.field_objects.typography.makeBool(e("#"+s+" .redux-typography-google-font").val()),e("#"+s).hasClass("typography-initialized")||(b=e("#"+s+" select.redux-typography-style").data("value"),m=e("#"+s+" select.redux-typography-subsets").data("value"),""!==b&&(b=String(b)),void 0!==typeof m&&(m=String(m))),void 0===redux.fonts.google&&(j=!1);var C="",z,k;if(C=!0===j&&l in redux.fonts.google?redux.fonts.google[l]:{400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"},e(o).hasClass("redux-typography-subsets")&&e("#"+s+" input.typography-subsets").val(m),e(o).hasClass("redux-typography-family")){var I='<option value=""></option>';if(!0===j){var O="";e.each(C.variants,(function(e,t){t.id===b||1===redux.field_objects.typography.size(C.variants)?(O=' selected="selected"',b=t.id):O="",I+='<option value="'+t.id+'"'+O+">"+t.name.replace(/\+/g," ")+"</option>"})),e("#"+s+" .redux-typography-style").select2("destroy"),e("#"+s+" .redux-typography-style").html(I),e("#"+s+" .redux-typography-style").select2(r),O="",I='<option value=""></option>',e.each(C.subsets,(function(t,a){a.id===m||1===redux.field_objects.typography.size(C.subsets)?(O=' selected="selected"',m=a.id,e("#"+s+" input.typography-subsets").val(m)):O="",I+='<option value="'+a.id+'"'+O+">"+a.name.replace(/\+/g," ")+"</option>"})),e("#"+s+" .redux-typography-subsets").select2("destroy"),e("#"+s+" .redux-typography-subsets").html(I),e("#"+s+" .redux-typography-subsets").select2(r),e("#"+s+" .redux-typography-subsets").parent().fadeIn("fast"),e("#"+s+" .typography-family-backup").fadeIn("fast")}else C&&(e.each(C,(function(t,a){t===b||"normal"===t?(O=' selected="selected"',e("#"+s+" .typography-style .select2-chosen").text(a)):O="",I+='<option value="'+t+'"'+O+">"+a.replace("+"," ")+"</option>"})),e("#"+s+" .redux-typography-style").select2("destroy"),e("#"+s+" .redux-typography-style").html(I),e("#"+s+" .redux-typography-style").select2(r),e("#"+s+" .redux-typography-subsets").parent().fadeOut("fast"),e("#"+s+" .typography-family-backup").fadeOut("fast"));e("#"+s+" .redux-typography-font-family").val(l)}else e(o).hasClass("redux-typography-family-backup")&&""!==n&&e("#"+s+" .redux-typography-font-family-backup").val(n);if(0===e("#"+s+" select.redux-typography-style option[value='"+b+"']").length?(b="",e("#"+s+" select.redux-typography-style").select2("val","")):"400"===b&&e("#"+s+" select.redux-typography-style").select2("val",b),0===e("#"+s+" select.redux-typography-subsets option[value='"+m+"']").length&&(m="",e("#"+s+" select.redux-typography-subsets").select2("val",""),e("#"+s+" input.typography-subsets").val(m)),e("."+("style_link_"+s)).remove(),null!==l&&"inherit"!==l&&e("#"+s).hasClass("typography-initialized")){var S=l.replace(/\s+/g,"+");if(!0===j){var B=S;b&&""!==b&&(B+=":"+b.replace(/\-/g," ")),m&&""!==m&&(B+="&subset="+m),!1===a&&"undefined"!=typeof WebFont&&WebFont&&WebFont.load({google:{families:[B]}}),e("#"+s+" .redux-typography-google").val(!0)}else e("#"+s+" .redux-typography-google").val(!1)}(-1!==b.indexOf("italic")?(e("#"+s+" .typography-preview").css("font-style","italic"),e("#"+s+" .typography-font-style").val("italic"),b=b.replace("italic","")):(e("#"+s+" .typography-preview").css("font-style","normal"),e("#"+s+" .typography-font-style").val("")),e("#"+s+" .typography-font-weight").val(b),h||(h=d),""===d||void 0===d?e("#"+s+" .typography-font-size").val(""):e("#"+s+" .typography-font-size").val(d+_),""===h||void 0===h?e("#"+s+" .typography-line-height").val(""):e("#"+s+" .typography-line-height").val(h+_),""===u||void 0===u?e("#"+s+" .typography-word-spacing").val(""):e("#"+s+" .typography-word-spacing").val(u+_),""===g||void 0===g?e("#"+s+" .typography-letter-spacing").val(""):e("#"+s+" .typography-letter-spacing").val(g+_),e("#"+s).hasClass("typography-initialized"))&&("0"==e("#"+s+" .typography-preview").data("preview-size")&&e("#"+s+" .typography-preview").css("font-size",d+_),e("#"+s+" .typography-preview").css("font-weight",b),e("#"+s+" .typography-preview").css("font-family",l+", sans-serif"),"none"===l&&""===l&&e("#"+s+" .typography-preview").css("font-family","inherit"),e("#"+s+" .typography-preview").css("line-height",h+_),e("#"+s+" .typography-preview").css("word-spacing",u+_),e("#"+s+" .typography-preview").css("letter-spacing",g+_),w&&(e("#"+s+" .typography-preview").css("color",w),e("#"+s+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(w))),e("#"+s+" .typography-style .select2-chosen").text(e("#"+s+" .redux-typography-style option:selected").text()),e("#"+s+" .typography-script .select2-chosen").text(e("#"+s+" .redux-typography-subsets option:selected").text()),c&&e("#"+s+" .typography-preview").css("text-align",c),f&&e("#"+s+" .typography-preview").css("text-transform",f),x&&e("#"+s+" .typography-preview").css("font-variant",x),v&&e("#"+s+" .typography-preview").css("text-decoration",v),e("#"+s+" .typography-preview").slideDown());e("#"+s).hasClass("typography-initialized")||e("#"+s).addClass("typography-initialized"),a=!1,p||redux_change(o)}}(jQuery);