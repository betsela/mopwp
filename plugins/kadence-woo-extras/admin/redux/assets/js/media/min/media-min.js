!function(e){"use strict";var i;redux.field_objects=redux.field_objects||{},redux.field_objects.media=redux.field_objects.media||{},redux.field_objects.media.init=function(d){d||(d=e(document).find(".redux-group-tab:visible").find(".redux-container-media:visible")),e(d).each((function(){var d=e(this),t=d;d.hasClass("redux-field-container")||(t=d.parents(".redux-field-container:first")),t.is(":hidden")||t.hasClass("redux-field-init")&&(t.removeClass("redux-field-init"),i=!1,d.find(".remove-image, .remove-file").unbind("click").on("click",(function(){redux.field_objects.media.removeFile(e(this).parents("fieldset.redux-field:first"))})),d.find(".media_upload_button").unbind().on("click",(function(i){redux.field_objects.media.addFile(i,e(this).parents("fieldset.redux-field:first"))})))}))},redux.field_objects.media.addFile=function(d,t){var a;d.preventDefault();var l=e(this),n;if(a)a.open();else{var o=e(t).find(".library-filter").data("lib-filter");void 0!==o&&""!==o&&(n=[],i=!0,o=decodeURIComponent(o),o=JSON.parse(o),e.each(o,(function(e,i){n.push(i)}))),(a=wp.media({multiple:!1,library:{type:n},title:l.data("choose"),button:{text:l.data("update")}})).on("select",(function(){var d=a.state().get("selection").first();a.close();var l=e(t).find(".data").data();if(void 0!==redux.field_objects.media&&void 0!==typeof redux.field_objects.media||(redux.field_objects.media={}),void 0!==l&&"undefined"!==l.mode||((l={}).mode="image"),!0===i&&(l.mode=0),0===l.mode);else if(!1!==l.mode&&d.attributes.type!==l.mode&&d.attributes.subtype!==l.mode)return;console.log(d),t.find(".upload").val(d.attributes.url),t.find(".upload-id").val(d.attributes.id),t.find(".upload-height").val(d.attributes.height),t.find(".upload-width").val(d.attributes.width),t.find(".upload-title").val(d.attributes.title),t.find(".upload-caption").val(d.attributes.caption),t.find(".upload-alt").val(d.attributes.alt),t.find(".upload-description").val(d.attributes.description),redux_change(e(t).find(".upload-id"));var n=d.attributes.url;if(void 0!==d.attributes.sizes&&void 0!==d.attributes.sizes.thumbnail)n=d.attributes.sizes.thumbnail.url;else if(void 0!==d.attributes.sizes){var o=d.attributes.height;for(var r in d.attributes.sizes){var s=d.attributes.sizes[r];s.height<o&&(o=s.height,n=s.url)}}else n=d.attributes.icon;t.find(".upload-thumbnail").val(n),t.find(".upload").hasClass("noPreview")||t.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+n+'">').slideDown("fast"),t.find(".remove-image").removeClass("hide"),t.find(".redux-background-properties").slideDown()})),a.open()}},redux.field_objects.media.removeFile=function(i){var d;i.find(".remove-image").addClass("hide")&&(i.find(".remove-image").addClass("hide"),i.find(".upload").val(""),i.find(".upload-id").val(""),i.find(".upload-height").val(""),i.find(".upload-width").val(""),i.find(".upload-title").val(""),i.find(".upload-caption").val(""),i.find(".upload-alt").val(""),i.find(".upload-description").val(""),i.find(".upload-thumbnail").val(""),redux_change(e(i).find(".upload-id")),i.find(".redux-background-properties").hide(),i.find(".screenshot").slideUp(),i.find(".remove-file").unbind(),i.find(".section-upload .upload-notice").length>0&&i.find(".media_upload_button").remove())}}(jQuery);